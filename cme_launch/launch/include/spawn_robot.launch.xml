<?xml version="1.0" encoding="UTF-8"?>
<launch>
	<arg name="robot"/>

	<arg name="gazebo" default="$(optenv ENABLE_GAZEBO true)"/>
	<arg name="manipulator" default=""/>

	<arg name="robot_description" default=""/>
	<arg name="robot_description_extras" default=""/>
	<arg name="manipulator_config" default=""/>

	<!--Robot description to param server-->
	<param if="$(eval robot_description != '')" name="robot_description"
	       command="xacro --inorder '$(arg robot_description)' $(arg robot_description_extras)"/>

	<!-- TODO: x, y, z args? unpause? -->
	<node if="$(arg gazebo)" name="$(arg robot)_spawn" pkg="gazebo_ros" type="spawn_model" output="screen"
	      args="-z 0.1 -urdf -param robot_description -model $(arg robot)"/>

	<!-- load given manipulator -->
	<group if="$(eval manipulator != '')">
		<rosparam if="$(eval manipulator_config != '')" command="load"
		          file="$(arg manipulator_config)"/>
		<rosparam unless="$(eval manipulator_config != '')" command="load"
		          file="$(find cme_control)/config/$(arg robot)/$(arg manipulator)/controller.yaml"/>
		<!-- Delegate controller spawning to manipulator launch files -->
		<node name="arm_controller_spawner" pkg="controller_manager" type="controller_manager"
		      args="spawn arm_controller" respawn="false" output="screen"/>
	</group>
</launch>
